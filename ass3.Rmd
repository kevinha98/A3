---
title: "Assignment 3"
author:
- Kevin Ha - 571821
- Ola Andre Olofsson - 170745
fontsize: 12pt
linestrech: 1.5
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
lang: no-NB
---

```{r setup, message=FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(styler)
library(tibble)
library(tidyverse)
options(scipen = 999)
```

# Answer the following questions
### 1. What information does the file ddf_concepts.csv contain?
Den inneholder blant annet "description" av diverse variabler.

### 2. What information does the file ddf--entities--geo--country.csv contain?
Den tilskriver land ulike faktorer som:
* Innenlandsstat eller stat med kystlinje
* Geografiske koordinater med lengde- og breddegrader
* Hovedreligion
* Medlemskap i FN

### 3. What information does the file ddf--entities--geo--un_sdg_region.csv contain?
Den inneholder informasjon om åtte ulike regioner som er FN-regioner. Dette fremkommer delvis av filnavnet som inneholder UN. SDG tenker jeg står for Sustainable Development Goals, men ser ikke helt sammenhengen her ennå.

### 4. What variables does the gapminder dataset from the gapminder package contain? To what continent are Australia and New Zealand assigned?
```{r}
library(gapminder)
```
Australia og New Zealing er angitt til Oseania. Datasettet viser landsliste med kontinentnavn, forventet levealder, BNP og populasjon.

### 5. Recreate the continent variable in gapminder with the new data. Only include countries that have a iso3166_1_alpha3 code. Use data from ddf--entities--geo--country.csv and call this tibble g_c. Let g_c be your main tibble in the following, i.e. add variables to this tibble.

```{r g_c}
library(readr)
g_c <- read_csv("data/ddf--entities--geo--country.csv")
as_tibble(g_c)
```

```{r kontinenter}
# Angir ønsket navn, g_c, til datasettet

g_c <- g_c %>%
  
# Lager ny variabel med case_when-funksjonen som lar oss vektorisere flere vilkår (statements) samtidig
  mutate(continent = case_when(
     world_4region == "asia" & un_sdg_region %in% c(
       "un_australia_and_new_zealand",
       "un_oceania_exc_australia_and_new_zealand") ~ "Oceania",

    world_4region ==  "asia" & !(un_sdg_region %in% c(
      "un_australia_and_new_zealand",
      "un_oceania_exc_australia_and_new_zealand")) ~ "Asia",

    world_4region == "africa" ~ "Africa",
    world_4region == "americas" ~ "Americas",
    world_4region ==  "europe" ~ "Europe")
  ) %>%
 filter(!is.na(iso3166_1_alpha3))
```

### 6a. How many countries are there now?
```{r}
# Teller antall rader med land, og vi får 247 land
nrow(g_c)

# Alternativt kan vi bruke length(unique)
length(unique(g_c$country))
```

### 6b. How many countries are there now in each continent?
```{r}
g_c %>%
  group_by(continent) %>%
  summarise(countries = length(unique(country)))
```
## Adding a new variable

### 7. Create the variable Life Expectancy (lifeExp) in g_c from the file

```{r Life Expectancy}
# Vi angir lesningen av filen for "lifeExp"
lifeExp <- read_csv("data/countries-etc-datapoints/ddf--datapoints--life_expectancy_years--by--geo--time.csv",
                    # Vi angir formatet på tidsvariabelen følgelig til Year
                    col_types = cols(
                      time = col_date(format = "%Y")))
lifeExp <- lifeExp %>%
  rename(year = time)
names(lifeExp)
```
### 8. How many countries have information about lifeExp?
```{r antall land med data om forventet levealder}
# Ved å kjøre følgende funksjon, får vi at 195 land har informasjon om forvente levealder
length(unique(lifeExp$geo))
```
## Select relevant variables in g_c

### 9. Reduce g_c to the variables: country, name, iso3166_1_alpha3, un_sdg_region, world_4region, continent, world_6region. Select the variables we need from g_c. Then add the variables from lifeExp.
```{r}
g_c <- g_c %>%
select(country,
       name,
       iso3166_1_alpha3,
       un_sdg_region,
       world_4region,
       continent,
       world_6region,
       ) %>%
  # Vi bruker left_join for å merge dataen fra "lifeExp" inn i datasettet "g_c"
left_join(lifeExp, by = c("country" = "geo")) %>%
filter(!(is.na(year) & is.na(life_expectancy_years))) %>%
filter(year < "2020-01-01")
```

```{r}
# Vi undersøker nå hvilke variabler vi har i datasettet, og vurderer om vi er fornøyd
names(g_c)
```
### 10. What is the first observation of lifeExp for the different countries?
```{r}
# Vi opprettet et datasett som vi kaller g_c_min som er filtrert, og viser oss land med årstall
g_c_min <- g_c %>%
  # Vi grupperer etter land
group_by(country) %>%
  # Deretter oppsummerer vi alle minimumsverdiene av variabelen år, og kaller det "year_min"
summarise(year_min = min(year)) %>%
  # Sorterer deretter i synkende rekkefølge
arrange(desc(year_min))
# Følgelig får vi et oversiktlig datasett, g_c_min, som viser minimumsverdiene av årstall i synkende rekkefølge
```

```{r}
table(g_c_min$year_min)
```
Her ser vi at vi har 186 observasjonen er funnet i året 1800, og 9 observasjoner er funnet i året 1950.

### 11. What are the names of the 9 countries that only have life expectancy data from 1950?
```{r}
# Her sjekker vi hvilke land som har sin første observasjon i år 1950
gcm <- g_c_min[g_c_min$year_min == "1950-01-01", "country"]
gcm
```
Landene er hhv. "and", "dma", "kna", "mco", "mhl", "nru", "plw", "smr" og "tuv".

```{r}
g_c_min <- g_c_min %>%
  # Vi henter landsnavnene fra datasettet "g_c".
  left_join(g_c,
            by = "country") %>%
  filter(year_min == "1950-01-01")
tibble(country = unique(g_c_min$name))
```
Vi får følgende land; Andorra, Dominica, St. Kitts and Nevis, Monaco, Marshall Islands, Nauru, Palau, San Marino, Tuvalu.

## 12

```{r read_in total_population}
total_population <- read_csv("data/countries-etc-datapoints/ddf--datapoints--population_total--by--geo--time.csv", 
  col_types = cols(
  time = col_date(format = "%Y")))
```

```{r join}
g_c <- g_c %>% 
  left_join(total_population, by = c("country" = "geo", "year" = "time"))
```

## 13

```{r}
gdp_pc <- read_csv("data/countries-etc-datapoints/ddf--datapoints--gdppercapita_us_inflation_adjusted--by--geo--time.csv",
  col_types = cols(
  time = col_date(format = "%Y")))
```

```{r}
g_c <- g_c %>% 
  left_join(gdp_pc, by = c("country" = "geo", "year" = "time"))
```

```{r}
g_c = g_c %>% 
  rename(lifeExp = life_expectancy_years,
         pop = population_total,
         gdpPercap = gdppercapita_us_inflation_adjusted)
```

```{r}
names(g_c)
```

## 14
Vi skal ha dataene fra 1800 til 2015, men inkludert 2019. Vi bruker først og fremst paste() funksjonen for å hente ut dataene fra settet og få R til å gjøre deler av jobben for oss. Vi bruker "-" for å seprere bort datoene, da vi bare skal ha årene. Dvs. i stedenfor 1900-01-01 så skal vi bare ha 1900. Vi bruker Parse() til å formatere hvilken oppsett vi skal ha på datoene.

```{r}
år_5 <- paste(c(seq(1800, 2015, by=5), 2019),
  "01-01", sep = "-") %>%
  parse_date("%Y-%m-%d")
```

```{r}
g_c_5 <- data.frame(år_5)
```

```{r}
dim(g_c_5)
```


```{r}
# Siste
```

